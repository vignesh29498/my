import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.naive_bayes import MultinomialNB
from sklearn.pipeline import make_pipeline
import joblib
import re

# Function to load and preprocess data
def load_data(file_path, priority_columns):
    df = pd.read_csv(file_path)
    df['Combined'] = df[priority_columns].apply(lambda x: ' '.join(x.astype(str)), axis=1)
    return df

# Training the Naive Bayes model
def train_model(df):
    model = make_pipeline(TfidfVectorizer(), MultinomialNB())
    model.fit(df['Combined'], df.index)
    return model

# Save the model
def save_model(model, model_path):
    joblib.dump(model, model_path)

# Load the model
def load_model(model_path):
    return joblib.load(model_path)

# Function to preprocess input sentence
def preprocess_input(sentence):
    sentence = re.sub(r'\W+', ' ', sentence).lower()
    return sentence

# Function to predict the full row using the trained model
def predict(model, sentence, df):
    preprocessed_sentence = preprocess_input(sentence)
    predicted_index = model.predict([preprocessed_sentence])[0]
    full_row = df.iloc[predicted_index]
    return full_row

# Main function to execute the workflow
def main(file_path, priority_columns, model_path, input_sentence):
    # Load and preprocess data
    df = load_data(file_path, priority_columns)

    # Train the model and save it
    nb_model = train_model(df)
    save_model(nb_model, model_path)

    # Load the model
    loaded_model = load_model(model_path)

    # Perform prediction using the loaded model
    full_row = predict(loaded_model, input_sentence, df)

    # Display results
    print(f"Predicted row:\n{full_row}")

# Parameters
file_path = 'your_training_data.csv'  # Replace with your CSV file path
priority_columns = ['Description', 'Keywords']  # Replace with your column names
model_path = 'naive_bayes_model.pkl'
input_sentence = "I need a small versatile tool for everyday use."

# Run the main function
main(file_path, priority_columns, model_path, input_sentence)
